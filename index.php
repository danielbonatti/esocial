<?php                                

 include('ws_esocial.php');           

 $sefaz = new ws_esocial();           

 $url = 'https://webservices.envio.esocial.gov.br/servicos/empregador/enviarloteeventos/WsEnviarLoteEventos.svc';
 $xml = '<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:v1="http://www.esocial.gov.br/servicos/empregador/lote/eventos/envio/v1_1_0"><soapenv:Header></soapenv:Header><soapenv:Body><v1:EnviarLoteEventos><v1:loteEventos><eSocial  xmlns="http://www.esocial.gov.br/schema/lote/eventos/envio/v1_1_1"><envioLoteEventos grupo="1"><ideEmpregador><tpInsc>1</tpInsc><nrInsc>46886149</nrInsc></ideEmpregador><ideTransmissor><tpInsc>1</tpInsc><nrInsc>46886149000110</nrInsc></ideTransmissor><eventos><evento Id="ID1468861490000002024082216275300252"><eSocial xmlns="http://www.esocial.gov.br/schema/evt/evtTabRubrica/v_S_01_02_00"><evtTabRubrica Id="ID1468861490000002024082216275300252"><ideEvento><tpAmb>1</tpAmb><procEmi>1</procEmi><verProc>2.04.01</verProc></ideEvento><ideEmpregador><tpInsc>1</tpInsc><nrInsc>46886149</nrInsc></ideEmpregador><infoRubrica><inclusao><ideRubrica><codRubr>0002</codRubr><ideTabRubr>SIGS</ideTabRubr><iniValid>2019-01</iniValid></ideRubrica><dadosRubrica><dscRubr>DSR</dscRubr><natRubr/><tpRubr/><codIncCP/><codIncIRRF/><codIncFGTS/></dadosRubrica></inclusao></infoRubrica></evtTabRubrica><Signature xmlns="http://www.w3.org/2000/09/xmldsig#"><SignedInfo><CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/><SignatureMethod Algorithm="http://www.w3.org/2001/04/xmldsig-more#rsa-sha256"/><Reference URI=""><Transforms><Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/><Transform Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/></Transforms><DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256"/><DigestValue>9oAyOIsbzN+1aEpppm9m3+P8/bITm7O9Gog9Cp2spig=</DigestValue></Reference></SignedInfo><SignatureValue>FzTidwyEnHuHw3wmz5Oa13AdSbrJM9hlFDLaPHo+ZiPC4EQcKhic4vnAVd6Kbx+Whif4uK2/3QVBOZiMD3WFCCcsFAwyi+xWX1kyd19kHP2MJ2S5pdO3mAs0WKg4l05Kzu+IiwJx5Kfu6ojMdMl2awdE/Zk5xoWvwdyA/ArhoB2yOoJIenqE0rZqmm1ZZRx1915ggRw0Rqzg1iRHsdQQi7S6j2i0TWXJlSOAqPGDEpjtXlUjsx/gpVXKn3yzwX7/d+N42Y44h3H6OLQV7OydbVct2z4JXwMtRWFqEKyOsjCVcRg8i7Ihd4dWcuqF8UfmeMZM/8U9j+ocbx143yyjVQ==</SignatureValue><KeyInfo><X509Data><X509Certificate>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</X509Certificate></X509Data></KeyInfo></Signature></eSocial></evento></eventos></envioLoteEventos></eSocial></v1:loteEventos></v1:EnviarLoteEventos></soapenv:Body></soapenv:Envelope>';
 $certificado = 'cap2024.pfx';
 $senha = '249991';
 $soapaction = 'http://www.esocial.gov.br/servicos/empregador/lote/eventos/envio/v1_1_0/ServicoEnviarLoteEventos/EnviarLoteEventos';

 if (file_exists("retorno.xml")) {    
     unlink("retorno.xml");           
 }                                    

 $resultado = $sefaz->consome($xml, $url, $certificado, $senha, $soapaction);
 echo $resultado;
